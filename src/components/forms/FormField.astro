---
import "../../styles/typography/ui.css";

interface Props {
  id?: string;
  label?: string;
  name?: string;
  required?: boolean;
  optionalLabel?: string;
  helper?: string;
  error?: string;
  state?: 'default' | 'error' | 'success' | 'loading' | 'disabled';
  size?: 'sm' | 'md' | 'lg';
  class?: string;
}

const {
  id,
  label = '',
  name,
  required = false,
  optionalLabel = 'Optional',
  helper = '',
  error = '',
  state = 'default',
  size = 'md',
  class: className = ''
} = Astro.props as Props;

const fieldId = id ?? (name ? `field-${name}` : undefined);
const describedBy = [] as string[];
if (helper && fieldId) describedBy.push(`${fieldId}-helper`);
if (error && fieldId) describedBy.push(`${fieldId}-error`);
const ariaDescribedBy = describedBy.length ? describedBy.join(' ') : undefined;
---

<div class={`form-field ${className}`} data-state={state}>
  {label && (
    <label for={fieldId} class="form-field__label">
      {label}
      {required ? <span class="form-field__required">*</span> : <span class="form-field__optional">{optionalLabel}</span>}
    </label>
  )}

  <div class="form-field__control" aria-describedby={ariaDescribedBy}>
    <slot />
  </div>

  {helper && <p id={`${fieldId}-helper`} class="form-field__helper">{helper}</p>}
  {error && <p id={`${fieldId}-error`} class="form-field__error" role="alert">{error}</p>}
</div>

<style>
.form-field { display: flex; flex-direction: column; gap: 0.25rem; }
.form-field__label { font-weight: 600; color: var(--color-text-primary); display:flex; align-items:baseline; gap:0.5rem; }
.form-field__required { color: var(--color-state-error); }
.form-field__optional { color: var(--color-text-muted); font-weight: 400; font-size: 0.9rem; }
.form-field__control { display:block; }
.form-field__helper { font-size: 0.9rem; color: var(--color-text-muted); margin-top: 0.25rem; }
.form-field__error { font-size: 0.9rem; color: var(--color-state-error); margin-top: 0.25rem; }

/* Grid helpers */
.form-grid { display: grid; gap: 1rem; grid-template-columns: 1fr; }
@media (min-width: 768px) { .form-grid { grid-template-columns: repeat(2, 1fr); gap: 1.25rem; } }

.form-field[data-state="error"] .form-field__control input,
.form-field[data-state="error"] .form-field__control textarea {
  border-color: var(--color-state-error);
}
</style>